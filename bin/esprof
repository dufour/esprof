#!/usr/bin/env node


var fs = require('fs');
var esprof;
try {
    esprof = require('esprof');
} catch (e) {
    esprof = require('../lib/main');
}

var cli = require('commander');

cli
    .version(require("../package").version)
    .usage('[options] <file.js>+');
esprof.EVENTS.forEach(function (e) {
    // cli.option("--" + e, "Enable " + e + " event [true]", true);
    cli.option("--no-" + e, "Disable " + e + " event", false);
});

function parseCmdLine() {
    cli.parse(process.argv);
}

function processFile(fname) {
    var content = fs.readFileSync(fname, 'utf-8');
    var options = {
        scriptName: fname
    };
    esprof.EVENTS.forEach(function (e) {
        options[e] = cli[e];
    });

    var output = esprof.instrument(content, options);
    console.log(output);
}

function main() {
    parseCmdLine();
    if (cli.args.length === 0) {
        console.error('Error: no input file.');
        cli.help();
    }

    cli.args.forEach(processFile);
}

main();